<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="../../favicon.ico">

    <title>Team Hungry Pacman</title>

    <!-- Bootstrap core CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0-alpha/css/bootstrap.css
" rel="stylesheet">
    <link href="bootstrap-css/bootstrap.min.css">

    <!-- Custom styles for this template -->
    <link href="style.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- JQuery-->

  </head>

  <body>

    <div class="site-wrapper" id="content">

      <div class="site-wrapper-inner">

        <div class="cover-container">

          <div class="inner cover">
            <a href = "index.html">
            <img src = "images\logo1.png" alt = "FoodNow logo" class="cover-heading">
            </a>
          </div>

          <section class = "container">
            <!-- row 1-->
          <div class = "row">
            <div><div class="col-sm-offset-2 col-sm-4"> 
              <div class="img-hover">
               <figure class = "border">
                <img class="img-responsive center-block" style="width: 50%; height: 50%" id="restaurant-one" src = "images\pacman.gif">
            </figure>
            <p id="name-one">
                
              </p>
            <p id="hours-one">

               </p>
            </div>
          </div>
          </div>

            <div><div class="col-sm-4"> 
              <div class="img-hover">
               <figure class = "border">
                <img class="img-responsive center-block" style="width: 50%; height: 50%" id="restaurant-two" src = "images\pacman.gif">
            </figure>
                  <p id="name-two">

                  </p>
                  <p id="hours-two">

                  </p>
            </div>
          </div>
          </div>
          </div>


            <!-- row 2 -->
            <div class = "row">
            <div><div class="col-sm-offset-2 col-sm-4"> 
              <div class="img-hover">
               <figure class = "border">
                <img class="img-responsive center-block" style="width: 50%; height: 50%" id="restaurant-three" src = "images\pacman.gif">
            </figure>
                  <p id="name-three">

                  </p>
                  <p id="hours-three">

                  </p>
            </div>
          </div>
          </div>
          <div class="col-sm-4">
            <div class="img-hover"> 
          <figure class = "border">
                <img class="img-responsive center-block" style="width: 50%; height: 50%" id="restaurant-four" src = "images\pacman.gif">
            </figure>
                <p id="name-four">

                </p>
                <p id="hours-four">

                </p>
            </div>
          </div>
          </div>

              <!-- row 3 -->
            <div class = "row">
              <div class="col-sm-offset-2 col-sm-8 ">
                  <button type="button" class="btn btn-primary btn-lg btn-block btn-custom">Show me more</button>
          </div>
          </div>

            </section>
        </div>
      
    </div>
    </div>
      <div id="map"></div>

    <footer class = "container">
            <div class="row">
            <p class = "col-sm-5">
                Brought to you by Team Hungry Pacman
                </p>
    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="../../assets/js/vendor/jquery.min.js"><\/script>')</script>
            <div id="main"></div>            
            <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCGs0EWNdioTn2rOt3Sczf6OsVBdVG6hE0&libraries=places,visualization" async defer></script>
  </body>
<script>

      // Global variables
      var map;
      var service;
      var infoWindow;
      var radius = 300;
      var pos;
      var places = new Array();
      var i;

      useCurrentLocation();

      function useCurrentLocation() {
          // Try HTML5 geolocation.
          if (navigator.geolocation) {
              navigator.geolocation.getCurrentPosition(function (position) {
                  pos = {
                      lat: position.coords.latitude,
                      lng: position.coords.longitude
                  };

                  searchUsingLocation(pos);

              }, function () {
                  handleLocationError(true, infoWindow, map.getCenter());
              });



          } else {
              // Browser doesn't support Geolocation
              handleLocationError(false, infoWindow, map.getCenter());
          }
      }


      function searchUsingLocation(pos) {
          map = new google.maps.Map(document.createElement('div'));
          service = new google.maps.places
          .PlacesService(map);

          var request = {
              location: new google.maps.LatLng(pos.lat, pos.lng),
              radius: 300,
              type: "restaurant",
          }

          service.nearbySearch(request, callback);



      }

      function callback(results, status) {
          if (status == google.maps.places.PlacesServiceStatus.OK) {
              for (var i = 0; i < results.length; i++) {
                  var place = results[i];
                  var request = {
                      placeId: place.place_id,

                  }
                  service.getDetails(request, callbackTwo);

              }
          }
      }

      function callbackTwo(place, status) {
          if (place !== null) {
              if (place.opening_hours !== undefined) {
                  if (place.opening_hours.open_now) {
                      if (place.opening_hours.weekday_text[6] !== undefined) {
                          if (place.photos !== undefined) {
                              var restaurant = {
                                  name: place.name, // name
                                  address: place.formatted_address, // address
                                  icon: place.icon, // icon
                                  photos: place.photos, // array of photos
                                  website: place.website, // website
                                  rating: place.rating, // rating
                                  position: place.geometry.location, // location
                                  times: place.opening_hours.weekday_text[6], // opening times

                              }


                              places.push(restaurant);
                              if (places.length === 4) {
                                  document.getElementById("restaurant-one").src = places[0].photos[0].getUrl({ 'maxWidth': 210, 'maxHeight': 144 });
                                  document.getElementById("name-one").innerHTML = places[0].name;
                                  document.getElementById("hours-one").innerHTML = places[0].times.substring(7, places[0].times.length);

                                  document.getElementById("restaurant-two").src = places[1].photos[0].getUrl({ 'maxWidth': 210, 'maxHeight': 144 });
                                  document.getElementById("name-two").innerHTML = places[1].name;
                                  document.getElementById("hours-two").innerHTML = places[1].times.substring(7, places[1].times.length);

                                  document.getElementById("restaurant-three").src = places[2].photos[0].getUrl({ 'maxWidth': 210, 'maxHeight': 144 });
                                  document.getElementById("name-three").innerHTML = places[2].name;
                                  document.getElementById("hours-three").innerHTML = places[2].times.substring(7, places[2].times.length);

                                  document.getElementById("restaurant-four").src = places[3].photos[0].getUrl({ 'maxWidth': 210, 'maxHeight': 144 });
                                  document.getElementById("name-four").innerHTML = places[3].name;
                                  document.getElementById("hours-four").innerHTML = places[3].times.substring(7, places[3].times.length);

                                  var images = document.getElementsByTagName("img");

                                      var img1 = images[1];
                                      img1.addEventListener("click", function () {
                                          var place = places[0];
                                          console.log(place.name);
                                          initMap(pos, place)
                                      });

                                      var img2 = images[2];
                                      img2.addEventListener("click", function () {
                                          var place = places[1];
                                          console.log(place.name);
                                          initMap(pos, place)
                                      });

                                      var img3 = images[3];
                                      img3.addEventListener("click", function () {
                                          var place = places[2];
                                          console.log(place.name);
                                          initMap(pos, place)
                                      });

                                      var img4 = images[4];
                                      img4.addEventListener("click", function () {
                                          var place = places[3];
                                          console.log(place.name);
                                          initMap(pos, place)
                                      });
                              }
                          }
                      }
                  }
              }

          } else {
              console.log(status);
          }

      }
      function initMap(pos, place) {
          document.getElementById("map").style.height = '700px';
          document.getElementById("content").style.display = 'none';
          console.log(place.name);
          map = new google.maps.Map(document.getElementById('map'), {
              center: pos,
              zoom: 15,
              styles: [{
                  stylers: [{ visibility: 'simplified' }]
              }, {
                  elementType: 'labels',
                  stylers: [{ visibility: 'off' }]
              }]
          });
          
          infoWindow = new google.maps.InfoWindow();
          service = new google.maps.places.PlacesService(map);

          var marker = new google.maps.Marker({
              position: pos,
              map: map,
          });

          addMarker(place);

      }

      function addMarker(place) {
          var marker = new google.maps.Marker({
              map: map,
              position: place.position,
              icon: {
                  url: 'http://maps.gstatic.com/mapfiles/circle.png',
                  anchor: new google.maps.Point(10, 10),
                  scaledSize: new google.maps.Size(10, 17)
              }
          });

          google.maps.event.addListener(marker, 'click', function (place) {
              infoWindow.setContent(place.name);
              infoWindow.open(map, marker);
          });
      }

</script>
</html>
